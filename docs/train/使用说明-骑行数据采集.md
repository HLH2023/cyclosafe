# 骑行页面数据采集使用说明

> **版本**: v1.0
> **创建日期**: 2025-10-03
> **适用范围**: 骑行页面后台数据采集

---

## 📱 功能概述

骑行页面集成了后台数据采集功能，可以在日常骑行过程中自动收集"正常"骑行数据，用于训练摔倒检测模型。

### 主要特点

- ✅ **后台采集** - 骑行过程中自动采集传感器数据
- ✅ **自动上传** - 骑行结束时自动上传数据
- ✅ **开关控制** - 可随时开启/关闭数据采集
- ✅ **长时间支持** - 支持长达50分钟的骑行数据采集
- ✅ **实时反馈** - 显示已采集的数据点数

---

## 🚀 快速开始

### 1. 开启数据采集

在骑行页面顶部，点击**科学烧瓶图标**（🧪）开启数据采集功能：

- **灰色图标** = 数据采集关闭
- **蓝色图标** = 数据采集开启

### 2. 开始骑行

点击中间的**播放按钮**开始骑行：

- 系统会自动开始采集传感器数据（如果开关已开启）
- 右上角会显示已采集的数据点数

### 3. 正常骑行

- 像平时一样骑行即可
- 数据会在后台持续采集
- 暂停骑行时，数据采集也会暂停（数据保留）
- 继续骑行时，数据采集自动恢复

### 4. 结束骑行

点击**停止按钮**结束骑行：

- 系统会自动停止数据采集
- 如果采集了足够的数据（≥100个点），会自动上传到服务器
- 数据会被标记为"正常"（normal）类别

---

## 📊 数据采集详情

### 采集参数

| 参数 | 值 | 说明 |
|-----|---|------|
| 采样率 | 50 Hz | 每秒采集50个数据点 |
| 缓冲区大小 | 150,000点 | 支持约50分钟骑行 |
| 最小上传量 | 100点 | 少于100点不会上传 |
| 数据标签 | normal | 自动标记为正常数据 |
| 数据来源 | riding | 标记来源为骑行页面 |

### 采集的数据

每个数据点包含6个维度：

- **加速度计**: `ax`, `ay`, `az` (g)
- **陀螺仪**: `gx`, `gy`, `gz` (rad/s)

### 元数据

上传时会附带以下骑行元数据：

```javascript
{
  riding_duration: 1234,    // 骑行时长（秒）
  riding_distance: 5.6,     // 骑行距离（公里）
  avg_speed: 18.5,          // 平均速度（km/h）
  max_speed: 32.1,          // 最高速度（km/h）
  collection_method: 'riding_page'
}
```

---

## ⚙️ 设置说明

### 数据采集开关

- **位置**: 骑行页面右上角
- **图标**: 科学烧瓶 (🧪)
- **状态保存**: 自动保存，下次打开页面时恢复

**如何使用**：

1. 点击图标切换开关状态
2. 蓝色 = 开启，灰色 = 关闭
3. 可以在骑行前或骑行中切换
4. 设置会自动保存到本地存储

### 默认设置

- **默认状态**: 开启
- **首次使用**: 建议保持开启

---

## 💡 使用建议

### 何时开启数据采集

**推荐开启**：
- ✅ 日常通勤骑行
- ✅ 休闲骑行
- ✅ 在平坦路面骑行
- ✅ 正常速度骑行（10-30 km/h）

**可以关闭**：
- 🚫  练习摔倒动作时（使用模拟摔倒页面）
- 🚫  电量较低时
- 🚫  不想贡献数据时

### 数据质量建议

为了采集高质量的"正常"骑行数据：

1. **保持手机稳定** - 放在口袋或固定在车上
2. **避免剧烈晃动** - 正常骑行即可
3. **多样化场景** - 不同路况、不同速度
4. **足够的时长** - 建议每次骑行至少5分钟

---

## 📈 数据统计

### 查看已上传数据

在模拟摔倒页面底部可以查看数据统计：

- 总样本数
- 摔倒样本数
- 正常样本数

或者通过API查询：

```bash
curl -H "X-API-Key: dev-test-key-2024" \
     http://localhost:8000/api/data/stats
```

### 贡献目标

| 数据类型 | 目标数量 | 来源 |
|---------|---------|------|
| 正常样本 | 1000+ | 骑行页面（主要） |
| 摔倒样本 | 100+ | 模拟摔倒页面 |

---

## ❓ 常见问题

### Q1: 数据采集会影响性能吗？

**A**: 影响很小。数据采集在后台运行，对骑行页面的性能影响可以忽略不计。

### Q2: 数据采集会增加电量消耗吗？

**A**: 会有轻微增加，因为需要持续读取传感器数据。如果电量较低，可以关闭数据采集开关。

### Q3: 如果骑行时间很短怎么办？

**A**: 系统会检查数据量，少于100个数据点（约2秒）的数据不会上传，所以短时间骑行不用担心。

### Q4: 暂停骑行时数据会丢失吗？

**A**: 不会。暂停时数据会保留，继续骑行时会继续采集。

### Q5: 可以查看采集了多少数据吗？

**A**: 可以。骑行时，右上角的数字显示已采集的数据点数。

### Q6: 上传失败怎么办？

**A**: 如果上传失败，会显示提示信息。数据会被丢弃，下次骑行会重新采集。确保：
- 后端服务正在运行
- 网络连接正常
- API配置正确

### Q7: 如何完全关闭数据采集？

**A**: 点击右上角的烧瓶图标，图标变灰色即表示关闭。设置会自动保存。

---

## 🔧 技术细节

### 工作流程

```
1. 用户开启数据采集开关
   ↓
2. 点击开始骑行
   ↓
3. DataCollector初始化并开始采集
   ↓
4. 后台持续采集传感器数据（50Hz）
   ↓
5. 实时更新已采集数据点数
   ↓
6. 用户点击停止骑行
   ↓
7. 停止采集并检查数据量
   ↓
8. 如果≥100点，自动上传到服务器
   ↓
9. 清空缓冲区，等待下次骑行
```

### 数据流

```
传感器 → DataCollector → 缓冲区 → 上传API → MySQL数据库
```

### 暂停/继续处理

- **暂停**: 停止采集，保留已采集的数据
- **继续**: 恢复采集，继续添加到缓冲区
- **停止**: 停止采集，上传（如果足够）并清空

---

## 🎯 下一步

1. **开始数据采集**
   - 开启数据采集开关
   - 日常骑行即可自动采集数据

2. **配合模拟摔倒页面**
   - 使用模拟摔倒页面采集摔倒数据
   - 两种数据配合，构建完整数据集

3. **查看统计**
   - 定期查看数据统计
   - 了解数据采集进度

4. **开始训练**
   - 当数据量足够时
   - 进入 Phase 4 模型训练

---

## 📞 支持

如遇到问题：

1. 检查后端服务是否运行
2. 查看小程序控制台日志
3. 参考主要文档：
   - [使用说明-数据采集.md](./使用说明-数据采集.md)
   - [构建进度文档](./train-construction-progress.md)

---

**祝骑行愉快！** 🚴‍♂️

感谢您为摔倒检测模型训练贡献数据！
