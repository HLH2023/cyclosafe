# 摔倒检测功能检查报告

## 功能支持情况

- `services/sensorService.js` 内置 `FallDetector` 类，结合加速度计、陀螺仪和速度数据执行阈值判断，同时提供摔倒与急刹车事件回调，默认启用并可按灵敏度调节，说明小程序已具备实时摔倒检测能力。【F:services/sensorService.js†L48-L361】【F:services/sensorService.js†L600-L803】
- ML 推理模块 `utils/mlModel.js` 支持加载随机森林模型、执行特征提取和滑动窗口预测，为传感器阈值法提供机器学习补充，进一步证明摔倒检测功能已经实现。【F:utils/mlModel.js†L1-L416】
- 项目说明文档在功能列表中将摔倒检测列为核心安全检测项，与代码实现互相印证当前小程序支持该功能。【F:README.md†L7-L133】

## 现有实现亮点

1. **多源融合判定**：阈值法同时考虑合成加速度、角速度、冲击特征以及速度骤降，可降低误报。【F:services/sensorService.js†L264-L361】
2. **灵敏度分档**：支持高、中、低三档阈值配置，并允许运行时切换，便于适配不同骑行场景。【F:services/sensorService.js†L90-L155】【F:services/sensorService.js†L780-L803】
3. **ML 兜底策略**：引入特征工程与随机森林模型，可在收集足够样本后进一步提升检测精度。【F:utils/mlModel.js†L1-L416】

## 优化空间建议

1. **改进频域特征效率**：当前 FFT 实现为 O(N²) 的离散傅里叶变换，窗口较大时在小程序端易产生性能瓶颈。可用更轻量的 FFT 库或预计算更少频域指标，降低推理延迟。【F:utils/mlModel.js†L106-L127】
2. **自适应阈值/校准**：阈值表使用固定常数，未考虑设备型号或骑行姿态差异。可结合设备启动时的静态校准或利用历史数据动态更新阈值，提高泛化性。【F:services/sensorService.js†L90-L138】
3. **融合置信度策略**：阈值检测与 ML 模型目前独立。可探索基于置信度的加权融合或投票机制，降低单一算法误判风险，同时利用 ML 模型给出的概率值做二次确认。【F:services/sensorService.js†L326-L361】【F:utils/mlModel.js†L279-L412】
4. **误报反馈闭环**：`FallDetector` 的回调未收集用户确认结果，导致阈值和模型难以在线优化。建议在报警弹窗中增加“误报”反馈，并记录到本地或云端以更新阈值或重新训练模型。【F:services/sensorService.js†L348-L490】
5. **能耗与资源管理**：传感器和检测常驻运行，冷却机制仅在事件后 5 秒生效。可根据速度或运动状态调整采样频率，或在停顿时暂停检测，延长续航。【F:services/sensorService.js†L78-L361】

## 结论

现有小程序已经集成摔倒检测，并提供阈值法与机器学习双重方案。若结合上述优化方向，可在性能、适应性及用户反馈利用方面进一步提升检测准确性与可用性。
